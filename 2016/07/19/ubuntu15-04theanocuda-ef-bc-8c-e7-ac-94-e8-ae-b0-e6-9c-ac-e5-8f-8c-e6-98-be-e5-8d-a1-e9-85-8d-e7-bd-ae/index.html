<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ubuntu15.04+Theano+CUDA，笔记本双显卡配置 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Theano安装在命令行输入 [shell]sudo apt-get updatesudo apt-get install python-numpy python-scipy python-dev python-pip python-nose g++ libopenblas-dev gitsudo pip install Theano[/shell] &amp;nbsp; 测试Theano NumPy (">
<meta property="og:type" content="article">
<meta property="og:title" content="ubuntu15.04+Theano+CUDA，笔记本双显卡配置">
<meta property="og:url" content="http://yoursite.com/2016/07/19/ubuntu15-04theanocuda-ef-bc-8c-e7-ac-94-e8-ae-b0-e6-9c-ac-e5-8f-8c-e6-98-be-e5-8d-a1-e9-85-8d-e7-bd-ae/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Theano安装在命令行输入 [shell]sudo apt-get updatesudo apt-get install python-numpy python-scipy python-dev python-pip python-nose g++ libopenblas-dev gitsudo pip install Theano[/shell] &amp;nbsp; 测试Theano NumPy (">
<meta property="og:updated_time" content="2017-08-24T13:29:12.466Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ubuntu15.04+Theano+CUDA，笔记本双显卡配置">
<meta name="twitter:description" content="Theano安装在命令行输入 [shell]sudo apt-get updatesudo apt-get install python-numpy python-scipy python-dev python-pip python-nose g++ libopenblas-dev gitsudo pip install Theano[/shell] &amp;nbsp; 测试Theano NumPy (">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ubuntu15-04theanocuda-ef-bc-8c-e7-ac-94-e8-ae-b0-e6-9c-ac-e5-8f-8c-e6-98-be-e5-8d-a1-e9-85-8d-e7-bd-ae" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/19/ubuntu15-04theanocuda-ef-bc-8c-e7-ac-94-e8-ae-b0-e6-9c-ac-e5-8f-8c-e6-98-be-e5-8d-a1-e9-85-8d-e7-bd-ae/" class="article-date">
  <time datetime="2016-07-18T16:03:32.000Z" itemprop="datePublished">2016-07-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/技/">技</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ubuntu15.04+Theano+CUDA，笔记本双显卡配置
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Theano安装"><a href="#Theano安装" class="headerlink" title="Theano安装"></a><strong>Theano安装</strong></h1><p>在命令行输入</p>
<p>[shell]<br>sudo apt-get update<br>sudo apt-get install python-numpy python-scipy python-dev python-pip python-nose g++ libopenblas-dev git<br>sudo pip install Theano<br>[/shell]</p>
<p>&nbsp;</p>
<p>测试Theano</p>
<p>NumPy (~30s):</p>
<p>[shell]<br>python -c &quot;import numpy; numpy.test()&quot;<br>[/shell]</p>
<p>SciPy (~1m):</p>
<p>[shell]<br>python -c &quot;import scipy; scipy.test()&quot;<br>[/shell]</p>
<p>Theano (~30m):</p>
<p>[shell]<br>python -c &quot;import theano; theano.test()&quot;<br>[/shell]</p>
<p>如果没有error就说明Theano安装完成</p>
<p>&nbsp;</p>
<hr>
<h1 id="CUDA安装"><a href="#CUDA安装" class="headerlink" title="CUDA安装"></a><strong>CUDA安装</strong></h1><p>在命令行输入</p>
<p>[shell]<br>sudo apt-get install nvidia-352 nvidia-prime nvidia-settings<br>sudo apt-get install nvidia-cuda-toolkit<br>[/shell]</p>
<p>测试</p>
<p>[shell]<br>nvidia-smi<br>[/shell]</p>
<p>出现</p>
<p>[shell]<br>NVIDIA-SMI has failed because it couldn’t communicate with the NVIDIA driver. Make sure that the latest NVIDIA driver is installed and running.<br>[/shell]</p>
<p>同时使用</p>
<p>[shell]<br>nvidia-settings<br>[/shell]</p>
<p>出现</p>
<p>[shell]<br><strong> Message: PRIME: No offloading required. Abort
</strong> Message: PRIME: is it supported? no<br>[/shell]</p>
<p>在搜了很多解决方法后发现，原因是笔记本是uefi的主版，需要进入bios禁用secureboot功能，在禁用后nvidia-smi即可正常使用。这个奇葩问题来源：<a href="http://forum.ubuntu.org.cn/viewtopic.php?f=42&amp;t=477917" target="_blank" rel="external">http://forum.ubuntu.org.cn/viewtopic.php?f=42&amp;t=477917</a></p>
<hr>
<h1 id="设置环境变量及测试"><a href="#设置环境变量及测试" class="headerlink" title="设置环境变量及测试"></a><strong>设置环境变量及测试</strong></h1><p>在命令行输入</p>
<p>[shell]<br>sudo gedit ~/.bashrc<br>[/shell]</p>
<p>在文件最后添加</p>
<p>[shell]<br>export PATH = &quot;/usr/lib/nvidia-cuda-toolkit/bin&quot;:$PATH<br>export LD_LIBRARY_PATH = &quot;/usr/lib/nvidia-cuda-toolkit/lib&quot;:$LD_LIBRARY_PATH<br>[/shell]</p>
<p>在命令行输入</p>
<p>[shell]<br>sudo gedit ~/.theanorc<br>[/shell]</p>
<p>在文件中写入</p>
<p>[shell]<br>[global]<br>device = gpu<br>floatX = float32</p>
<p>[nvcc]<br>fastmath = True</p>
<p>[cuda]<br>root = /usr/lib/nvidia-cuda-toolkit</p>
<p>[lib]<br>cnmem = 0.8</p>
<p>[blas]<br>ldflags = -lopenblas<br>[/shell]</p>
<p>测试blas加速能否正常工作</p>
<p>[shell]<br>import numpy<br>id(numpy.dot) == id(numpy.core.multiarray.dot)<br>[/shell]</p>
<p>得到结果为False则说明正常加速</p>
<p>创建一个theano_test.py文件，写入</p>
<p>[python]<br>from theano import function, config, shared, sandbox<br>import theano.tensor as T<br>import numpy<br>import time</p>
<p>vlen = 10 <em> 30 </em> 768 # 10 x #cores x # threads per core<br>iters = 1000<br>rng = numpy.random.RandomState(22)<br>x = shared(numpy.asarray(rng.rand(vlen), config.floatX))<br>f = function([], T.exp(x))<br>print f.maker.fgraph.toposort()</p>
<p>t0 = time.time()<br>for i in xrange(iters):<br>    r = f()<br>t1 = time.time()</p>
<p>print ‘Looping %d times took’ % iters, t1 - t0, ‘seconds’<br>print ‘Result is’, r<br>if numpy.any([isinstance(x.op, T.Elemwise) for x in f.maker.fgraph.toposort()]):<br>    print ‘Used the cpu’<br>else:<br>    print ‘Used the gpu’<br>[/python]</p>
<p>&nbsp;</p>
<p>切换到theano_test.py文件所在目录，在命令行输入</p>
<p>[shell]<br>python theano_test.py<br>[/shell]</p>
<p>出现</p>
<p>[shell]<br>WARNING (theano.sandbox.cuda): CUDA is installed, but device gpu is not available  (error: Unable to get the number of gpus available: unknown error)<br>[Elemwise{exp,no_inplace}(&lt;TensorType(float32, vector)&gt;)]<br>Looping 1000 times took 4.377858 seconds<br>Result is [ 1.23178029  1.61879337  1.52278066 …,  2.20771813  2.29967761 1.62323284]<br>Used the cpu<br>[/shell]</p>
<div>

<p>此时在命令行输入</p>
<p>[shell]<br>sudo python theano_test.py<br>[/shell]</p>
<p></p></div><br>可正常运行，出现<p></p>
<div>

<p>[shell]<br>Using gpu device 0: GeForce 840M (CNMeM is disabled, cuDNN not available)<br>[GpuElemwise{exp,no_inplace}(&lt;CudaNdarrayType(float32, vector)&gt;), HostFromGpu(GpuElemwise{exp,no_inplace}.0)]<br>Looping 1000 times took 1.110110 seconds<br>Result is [ 1.23178029 1.61879349 1.52278066 …, 2.20771813 2.29967761 1.62323296]<br>Used the gpu<br>[/shell]</p>
<p>再次输入</p>
<p>[shell]<br>python theano_test.py<br>[/shell]</p>
<p>出现错误（省略了部分语句）</p>
<p>[shell]<br>OSError: [Errno 13] Permission denied: ‘/home/zui/.theano/compiledir_Linux…’<br>[/shell]</p>
<p>此时利用rm -rf删除文件夹.theano文件夹即可</p>
<p>再次输入</p>
<p>[shell]<br>python theano_test.py<br>[/shell]</p>
<p>可以正常运行</p>
<p></p></div><br>之后每次重启，需要首先用root权限跑Theano代码（比如上面的theano_test.py），才能正常使用GPU，也可以选择建立一个脚本，具体参考<a href="http://www.johnwittenauer.net/configuring-theano-for-high-performance-deep-learning/" target="_blank" rel="external">http://www.johnwittenauer.net/configuring-theano-for-high-performance-deep-learning/</a>最后一点<p></p>
<p>&nbsp;</p>
<p>参考：</p>
<p><a href="http://deeplearning.net/software/theano/install.html" target="_blank" rel="external">http://deeplearning.net/software/theano/install.html</a></p>
<p><a href="http://deeplearning.net/software/theano/install_ubuntu.html" target="_blank" rel="external">http://deeplearning.net/software/theano/install_ubuntu.html</a></p>
<p><a href="http://deeplearning.net/software/theano/install.html" target="_blank" rel="external">l</a><a href="http://www.cnblogs.com/Ponys/p/3438491.html" target="_blank" rel="external">http://www.cnblogs.com/Ponys/p/3438491.html</a></p>
<p><a href="http://www.johnwittenauer.net/configuring-theano-for-high-performance-deep-learning/" target="_blank" rel="external">http://www.johnwittenauer.net/configuring-theano-for-high-performance-deep-learning/</a></p>
<p><a href="https://groups.google.com/forum/#!topic/theano-users/_Zd4kdkYlcQ" target="_blank" rel="external">https://groups.google.com/forum/#!topic/theano-users/_Zd4kdkYlcQ</a></p>
<p><a href="http://forum.ubuntu.org.cn/viewtopic.php?f=42&amp;t=477917" target="_blank" rel="external">http://forum.ubuntu.org.cn/viewtopic.php?f=42&amp;t=477917</a></p>
<p>其他还搜了很多资料，不一一列举</p>
<p>Tip：</p>
<p>利用</p>
<p>[shell]<br>lspci -k | grep -EA2 ‘VGA’<br>[/shell]</p>
<p>查看显卡时，由于nvidia有些显卡表示为“3D控制器”，所以需要使用</p>
<p>[shell]<br>lspci -k | grep -EA2 ‘VGA|3D’<br>[/shell]</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/19/ubuntu15-04theanocuda-ef-bc-8c-e7-ac-94-e8-ae-b0-e6-9c-ac-e5-8f-8c-e6-98-be-e5-8d-a1-e9-85-8d-e7-bd-ae/" data-id="cj6qhj9hc0009dr0km0mxcs8h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/09/01/e6-9c-ba-e5-99-a8-e5-ad-a6-e4-b9-a0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          --&gt;&gt;&gt;深度学习
        
      </div>
    </a>
  
  
    <a href="/2014/12/20/e6-96-87-e8-89-ba-e9-9d-92-e5-b9-b4/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">文艺青年</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技/">技</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/文/">文</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/08/24/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/08/06/pyqt-e7-bc-96-e7-a8-8b/">Pyqt编程</a>
          </li>
        
          <li>
            <a href="/2017/05/20/e5-a4-a7-e6-95-b0-e6-8d-ae-e6-af-94-e8-b5-9b/">------&gt;大数据比赛</a>
          </li>
        
          <li>
            <a href="/2016/11/13/ubuntu-e4-bf-ae-e6-94-b9python-e9-bb-98-e8-ae-a4-e7-bc-96-e7-a0-81/">Ubuntu修改Python默认编码</a>
          </li>
        
          <li>
            <a href="/2016/09/01/e6-9c-ba-e5-99-a8-e5-ad-a6-e4-b9-a0/">--&gt;&gt;&gt;深度学习</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>